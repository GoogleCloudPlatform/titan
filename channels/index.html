<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content="chrome=1" http-equiv="X-UA-Compatible">
    <meta content="Titan for App Engine : App Engine, extended." name="description">
    <link href="/titan/css/stylesheet.css" media="screen" rel="stylesheet">
    <title>
      Titan Channels - Titan for App Engine
    </title>
  </head>
  <body>
    <div class="outer" id="header_wrap">
      <header class="inner">
        <a href="https://github.com/GoogleCloudPlatform/titan" id="forkme_banner">View on
        GitHub</a>
        <h1 id="project_title">
          Titan for App Engine
        </h1>
        <h2 id="project_tagline">
          App Engine, extended.
        </h2>
        <section id="downloads">
          <a class="zip_download_link" href=
          "https://github.com/GoogleCloudPlatform/titan/zipball/master">Download this project as a
          .zip file</a> <a class="tar_download_link" href=
          "https://github.com/GoogleCloudPlatform/titan/tarball/master">Download this project as a
          tar.gz file</a>
        </section>
      </header>
    </div>
    <div class="outer" id="main_content_wrap">
      <section class="inner" id="main_content">
        <div id="breadcrumbs">
          <a href="/titan/">Titan</a> &gt; Titan Channels
        </div>
        <hr>
        <h1>
          Titan Channels
        </h1>
        <h2>
          Overview
        </h2>
        <p>
          <em>(from the <a href=
          "https://developers.google.com/appengine/docs/python/channel/overview">App Engine Channel
          API docs</a>)</em>
        </p>
        <blockquote>
          <p>
            The Channel API creates a persistent connection between your application and Google
            servers, allowing your application to send messages to JavaScript clients in real time
            without the use of polling. This is useful for applications designed to update users
            about new information immediately. Some example use-cases include collaborative
            applications, multi-player games, or chat rooms. In general, using the Channel API is a
            better choice than polling in situations where updates can't be predicted or scripted,
            such as when relaying information between human users or from events not generated
            systematically.
          </p>
        </blockquote>
        <h2>
          Introduction
        </h2>
        <p>
          Titan Channels is a simple wrapper around the native <a href=
          "https://developers.google.com/appengine/docs/python/channel/overview">App Engine Channel
          API</a> which adds the ability to have <strong>multiple users connected to a single
          channel</strong>.
        </p>
        <p>
          The native App Engine library is restricted to "<a href=
          "https://developers.google.com/appengine/docs/python/channel/overview#Caveats">one client
          per client ID</a>", so your application must manage the list of subscribed clients in
          order to send common messages to all of them. The Titan&nbsp;Channel API makes this
          common use-case easier by managing that list for you.
        </p>
        <h2>
          Demo
        </h2>
        <ul>
          <li>Demo: <a href=
          "https://titan-channel-demo.appspot.com/">https://titan-channel-demo.appspot.com/</a>
          </li>
          <li>Demo source: <a href=
          "https://github.com/GoogleCloudPlatform/titan/tree/master/samples/channel">https://github.com/GoogleCloudPlatform/titan/tree/master/samples/channel</a>
          </li>
        </ul>
        <h2>
          Usage
        </h2>
        <p>
          The code flow is very similar to using the native Channel API. The server-side code path
          looks something like:
        </p>
        <pre>
<code># First, create a secret channel token for the individual user's JavaScript client.
token = channel.CreateChannel(some_unique_client_id)
...
# Second, subscribe the client to the broadcast channel.
broadcast_channel = channel.BroadcastChannel('shared-channel-key')
broadcast_channel.Subscribe(some_unique_client_id)
...
# Send messages using the broadcast channel.
broadcast_channel.SendMessage('hello world!')
</code>
</pre>
        <p>
          While the client side using <a href=
          "https://developers.google.com/closure/library/">Google Closure Library</a> looks
          something like:
        </p>
        <pre>
<code>var broadcastChannel = new titan.channel.BroadcastChannel('');
goog.events.listen(
    broadcastChannel, titan.channel.BroadcastChannel.EventType.CONNECTED, function(e) {
      // After the connection is open, subscribe to all messages.
      broadcastChannel.subscribe();

      // This endpoint will call broadcast_channel.Subscribe() for the given client_id.
      goog.net.XhrIo.send('/join', null, 'POST', 'client_id=');
    });
broadcastChannel.connect('');
</code>
</pre>
        <hr>
        <p>
          Check out the demo app and source above that shows a simple chat room app. Basically, the
          important bits in the source are:
        </p>
        <p>
          The request handler to join the chat room:
        </p>
        <pre>
<code>from titan import channel

class JoinRoomHandler(webapp2.RequestHandler):

  def post(self):
    client_id = self.request.get('client_id')
    broadcast_channel = channel.BroadcastChannel(key='chat-room-name')
    broadcast_channel.Subscribe(client_id)
</code>
</pre>
        <p>
          And the request handler for sending a message:
        </p>
        <pre>
<code>from titan import channel
from titan import users

class SendMessageHandler(webapp2.RequestHandler):

  def post(self):
    user = users.GetCurrentUser()
    message = self.request.get('message')
    broadcast_channel = channel.BroadcastChannel(key='chat-room-name')
    message = '%s: %s' % (user.email, cgi.escape(message, quote=True))
    broadcast_channel.SendMessage(message)
</code>
</pre>
        <h2>
          Notes
        </h2>
        <p>
          This is beta and may change as we refine the API further. The sample app uses Google
          Closure for its JavaScript library—we would be happy to accept contributions for other
          JavaScript libraries.
        </p>
        <h2>
          Known issues:
        </h2>
        <ul>
          <li>You cannot subscribe to more than one broadcast channel on a page since the native
          Channel API limits to one open connection per page. This could be solved with a shared
          message queue internally to the Titan Channel API, but has not been implemented yet.
          </li>
        </ul>
      </section>
    </div>
    <div class="outer" id="footer_wrap">
      <footer class="inner">
        <p class="copyright">
          © Google - <a href="https://github.com/GoogleCloudPlatform">GoogleCloudPlatform</a>
        </p>
      </footer>
    </div><script src="//www.google.com/js/gweb/analytics/autotrack.js">
</script> <script>
new gweb.analytics.AutoTrack({
      profile: 'UA-24973566-1'
    });
    </script> <script>
(function(){
      var h=this;
function k(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==
b&&"undefined"==typeof a.call)return"object";return b}function n(a){var b=k(a);return"array"==b||"object"==b&&"number"==typeof a.length}function p(a){return"string"==typeof a}function q(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};function r(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")}function s(a){if(!t.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(v,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(w,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(x,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(aa,"&quot;"));return a}var v=/&/g,w=/</g,x=/>/g,aa=/\"/g,t=/[&<>\"]/;var y=Array.prototype,ba=y.indexOf?function(a,b,c){return y.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(p(a))return!p(b)||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},z=y.forEach?function(a,b,c){y.forEach.call(a,b,c)}:function(a,b,c){for(var e=a.length,g=p(a)?a.split(""):a,d=0;d<e;d++)d in g&&b.call(c,g[d],d,a)};function ca(a){var b=a.length;if(0<b){for(var c=Array(b),e=0;e<b;e++)c[e]=a[e];return c}return[]}
function da(a,b,c){return 2>=arguments.length?y.slice.call(a,b):y.slice.call(a,b,c)};var A,B,C,D;function E(){return h.navigator?h.navigator.userAgent:null}D=C=B=A=!1;var F;if(F=E()){var ea=h.navigator;A=0==F.indexOf("Opera");B=!A&&-1!=F.indexOf("MSIE");C=!A&&-1!=F.indexOf("WebKit");D=!A&&!C&&"Gecko"==ea.product}var G=A,H=B,I=D,J=C;function K(){var a=h.document;return a?a.documentMode:void 0}var L;
a:{var M="",N;if(G&&h.opera)var O=h.opera.version,M="function"==typeof O?O():O;else if(I?N=/rv\:([^\);]+)(\)|;)/:H?N=/MSIE\s+([^\);]+)(\)|;)/:J&&(N=/WebKit\/(\S+)/),N)var P=N.exec(E()),M=P?P[1]:"";if(H){var Q=K();if(Q>parseFloat(M)){L=String(Q);break a}}L=M}var R={};
function S(a){var b;if(!(b=R[a])){b=0;for(var c=r(String(L)).split("."),e=r(String(a)).split("."),g=Math.max(c.length,e.length),d=0;0==b&&d<g;d++){var f=c[d]||"",u=e[d]||"",fa=RegExp("(\\d*)(\\D*)","g"),ga=RegExp("(\\d*)(\\D*)","g");do{var l=fa.exec(f)||["","",""],m=ga.exec(u)||["","",""];if(0==l[0].length&&0==m[0].length)break;b=((0==l[1].length?0:parseInt(l[1],10))<(0==m[1].length?0:parseInt(m[1],10))?-1:(0==l[1].length?0:parseInt(l[1],10))>(0==m[1].length?0:parseInt(m[1],10))?1:0)||((0==l[2].length)<
(0==m[2].length)?-1:(0==l[2].length)>(0==m[2].length)?1:0)||(l[2]<m[2]?-1:l[2]>m[2]?1:0)}while(0==b)}b=R[a]=0<=b}return b}var T=h.document,U=!T||!H?void 0:K()||("CSS1Compat"==T.compatMode?parseInt(L,10):5);var ha=!H||H&&9<=U;!I&&!H||H&&H&&9<=U||I&&S("1.9.1");var V=H&&!S("9");function ia(a,b){var c;c=a.className;c=p(c)&&c.match(/\S+/g)||[];for(var e=da(arguments,1),g=c.length+e.length,d=c,f=0;f<e.length;f++)0<=ba(d,e[f])||d.push(e[f]);a.className=c.join(" ");return c.length==g};function ja(a,b){for(var c in a)b.call(void 0,a[c],c,a)}var W="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ka(a,b){for(var c,e,g=1;g<arguments.length;g++){e=arguments[g];for(c in e)a[c]=e[c];for(var d=0;d<W.length;d++)c=W[d],Object.prototype.hasOwnProperty.call(e,c)&&(a[c]=e[c])}};function la(a,b){ja(b,function(b,e){"style"==e?a.style.cssText=b:"class"==e?a.className=b:"for"==e?a.htmlFor=b:e in X?a.setAttribute(X[e],b):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?a.setAttribute(e,b):a[e]=b})}var X={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function ma(a,b,c){var e=arguments,g=document,d=e[0],f=e[1];if(!ha&&f&&(f.name||f.type)){d=["<",d];f.name&&d.push(' name="',s(f.name),'"');if(f.type){d.push(' type="',s(f.type),'"');var u={};ka(u,f);delete u.type;f=u}d.push(">");d=d.join("")}d=g.createElement(d);f&&(p(f)?d.className=f:"array"==k(f)?ia.apply(null,[d].concat(f)):la(d,f));2<e.length&&na(g,d,e);return d}
function na(a,b,c){function e(c){c&&b.appendChild(p(c)?a.createTextNode(c):c)}for(var g=2;g<c.length;g++){var d=c[g];if(n(d)&&!(q(d)&&0<d.nodeType)){var f;a:{if(d&&"number"==typeof d.length){if(q(d)){f="function"==typeof d.item||"string"==typeof d.item;break a}if("function"==k(d)){f="function"==typeof d.item;break a}}f=!1}z(f?ca(d):d,e)}else e(d)}}var oa={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1},Y={IMG:" ",BR:"\n"};
function Z(a,b,c){if(!(a.nodeName in oa))if(3==a.nodeType)c?b.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g,"")):b.push(a.nodeValue);else if(a.nodeName in Y)b.push(Y[a.nodeName]);else for(a=a.firstChild;a;)Z(a,b,c),a=a.nextSibling};H&&S("9");!J||S("528");I&&S("1.9b")||H&&S("8")||G&&S("9.5")||J&&S("528");I&&!S("8")||H&&S("9");function $(){}$.a=function(){$.b||($.b=new $)};$.a();var pa=window.document.querySelectorAll(["#main_content h1","#main_content h2","#main_content h3","#main_content h4"]);z(pa,function(a){var b;V&&"innerText"in a?b=a.innerText.replace(/(\r\n|\r|\n)/g,"\n"):(b=[],Z(a,b,!0),b=b.join(""));b=b.replace(/ \xAD /g," ").replace(/\xAD/g,"");b=b.replace(/\u200B/g,"");V||(b=b.replace(/ +/g," "));" "!=b&&(b=b.replace(/^\s*/,""));b=r(b).replace(/\s+/g,"-").replace(/[^a-zA-Z0-9\-\_]/g,"").toLowerCase();a.id=b;b=ma("a",{"class":"anchor",href:"#"+b},"\u00b6");a.appendChild(b)});
      }())
    </script>
  </body>
</html>